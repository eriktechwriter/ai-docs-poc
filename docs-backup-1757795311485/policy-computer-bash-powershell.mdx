---
slug: trend-vision-one-policy-computer-bash-powershell
title: Assign a policy to a computer (Bash and PowerShell)
---
# Assign a policy to a computer (Bash and PowerShell)

Assign a policy to a computer so that the computer is protected according to the policy configuration. For example, assign a policy to a computer that was just added to Server & Workload Protection, or that was discovered to have no policy assigned.

To assign a policy, you use the [Modify a Computer](https://automation.trendmicro.com/cloudone/workload-security/) operation.

## Before you begin {#before-you-begin}

You should have already verified that your environment is [set up to use the API using Bash or PowerShell](set-up-use-bash-or-powershell.mdx).

Gather the following information that you need to complete this recipe:

- The URL of Server & Workload Protection

- The secret key for your API key

- The ID of the computer to which you are assigning the policy

- The ID of the policy to assign

If you don't know the ID of the policy or the computer, you can use the [Search for a Policy](search-for-policy-bash-powershell.mdx) and [Get a List of Computers](get-list-computers-bash-powershell.mdx) recipes to obtain them.

## Bash {#bash}

### Procedure {#procedure}

1.  Open Terminal or your preferred command line tool.

2.  Enter the following commands to store details about your request, replacing `<YOUR URL>` with the URL of Server & Workload Protection, and `<YOUR SECRET KEY>` with the secret from your API key:

    - `url=<YOUR URL>`

      for example, `url=https://cloudone.trendmicro.com`

    - `secret=<YOUR SECRET KEY>`

      for example, `secret=5C58EADA-04BC-4ABC-45CF-B72925A0B674:aFBgpPV8eJQGaY2Dk0LmyQMD7nUGvyIDfIbIQo8Zgm8=`

3.  Enter the following command to store the ID of the computer, replacing `<YOUR COMPUTER ID>` with the ID of the computer:

    `computerID=<YOUR COMPUTER ID>`

    for example, `computerID=51`

4.  Enter the following command to store the ID of the policy, replacing `<YOUR POLICY ID>` with the ID of the computer:

    `policyID=<YOUR POLICY ID>`

    for example, `policyID=1`

5.  Enter the following command to specify the JSON file where you want to save the response data, replacing `<FILE PATH>` with the file to create. Specify a file name with the .json extension:

    `file=<FILE PATH>`

    for example, `file=~/Documents/computer_modify.json`

6.  Enter the following command to send the request:

    ```bash
    curl -X POST "$url/api/computers/$computerID" -H "api-secret-key: $secret" -H "api-version: v1" -H "Content-Type: application/json" -d "{ \"policyID\": \"$policyID\" }" > $file
    ```

    :::tip

    To print the returned JSON in the terminal in a readable format (instead of writing to a file), pipe the results of the cURL command to [jq](https://stedolan.github.io/jq/). In the above command, replace `> $file` with `| jq .`.
    :::

7.  Open the JSON file in a Web browser. (The Web browser should format the JSON so that it is readable.) You should see JSON code that represents a computer with the expected values for ID and policyID, similar to the following example.

    ```bash
    {
        hostName: "testcomputer",
        displayName: "my test computer",
        description: "",
        lastIPUsed: "",
        platform: "Windows",
        groupID: 0,
        policyID: 1,
        relayListID: 1,
        lastSendPolicyRequest: 1568653868230,
        agentVersion: "12.0.0.563",
        computerStatus: {...},
        computerSettings: {...},
        ID: 51,
        antiMalware: {...},
        webReputation: {...},
        sensingMode: {...},
        firewall: {...},
        intrusionPrevention: {...},
        integrityMonitoring: {...},
        logInspection: {...},
        applicationControl: {...}
    }
    ```

### Next steps {#next-steps}

:::tip

To keep the example brief, values that are comprised of multiple properties (i.e. objects) are represented as . You will see all the information in your results.
:::

## PowerShell {#powershell}

### Procedure {#procedure-1}

1.  Open PowerShell.

2.  Enter the following command to use TLS 1.2, which the manager requires to create a secure connection:

    ```bash
    [Net.ServicePointManager]::SecurityProtocol += [Net.SecurityProtocolType]::Tls12
    ```

3.  Enter the following commands to store details about your request, replacing `<YOUR URL>` with the URL of Server & Workload Protection, and `<YOUR SECRET KEY>`with the secret from your API key:

    - `$url = "<YOUR URL>"`

      for example, `url=https://cloudone.trendmicro.com`

    - `$secret = "<YOUR API KEY SECRET>"`

      for example, `$secret="5C58EADA-04BC-4ABC-45CF-B72725A0B674:aFBgpPV8eJQGaY2Dk0LmyQMD7nUGvyIDfIbIQo8Zgm8="`

    - `$headers = @{‘api-version’ = “v1”; ‘api-secret-key’ = $secret; 'Content-Type' = "application/json"}`

4.  Enter the following command to store the ID of the computer, replacing `<YOUR COMPUTER ID>` with the ID of the computer:

    `$computerID = "<YOUR COMPUTER ID>"`

    for example, `$computerID = "51"`

5.  Enter the following command to store the ID of the policy, replacing `<YOUR POLICY ID>` with the ID of the computer:

    `$policyID = "<YOUR POLICY ID>"`

    for example, `$policyID = "1"`

6.  Enter the following command to specify the JSON file where you want to save the response data, replacing `<FILE PATH>` with the file to create. Specify a file name with the .json extension:

    `$file="<FILE PATH>"`

    for example, `$file="$HOME\Documents\policy_search.json"`

7.  Enter the following command to send the request:

    ```bash
    Invoke-RestMethod -Method 'Post' -Uri "$url/api/computers/$computerID" -Headers $headers -Body @"
    {"policyID": "$policyID"}
    "@ -OutFile $file
    ```

    If you receive the error message `The underlying connection was closed: An unexpected error occurred on a send`, close PowerShell, open PowerShell again, and try repeating steps.

8.  Open the JSON file in a Web browser. (The Web browser should format the JSON so that it is readable.) You should see JSON code that represents a computer with the expected values for ID and policyID, similar to the following example.

    ```bash
    {
        hostName: "testcomputer",
        displayName: "my test computer",
        description: "",
        lastIPUsed: "",
        platform: "Windows",
        groupID: 0,
        policyID: 1,
        relayListID: 1,
        lastSendPolicyRequest: 1568653868230,
        agentVersion: "12.0.0.563",
        computerStatus: {...},
        computerSettings: {...},
        ID: 51,
        antiMalware: {...},
        webReputation: {...},
        sensingMode: {...},
        firewall: {...},
        intrusionPrevention: {...},
        integrityMonitoring: {...},
        logInspection: {...},
        applicationControl: {...}
    }
    ```

    :::tip

    To keep the example brief, values that are comprised of multiple properties (i.e. objects) are represented as . You will see all the information in your results.
    :::

### Next steps {#next-steps-1}

## Notes {#notes}

- If you open the JSON file in a text editor, the code appears on a single line which is difficult to read. Web browsers tend to format JSON so that it is readable. If your browser does not automatically format the JSON, consider installing a browser plugin that does.

- The returned computer object includes all of the configurations that are applied to the computer, including those set in the policy and any overrides that have been applied to the computer. To include only the overrides in the response, add `?overrides=true`\> to the URL in the request, for example `$url/api/computers/$computerID?overrides=true`.

## Related resources {#related-resources}

- [Set Up to Use Bash or PowerShell](set-up-use-bash-or-powershell.mdx)

- [Modify a Computer](https://automation.trendmicro.com/cloudone/workload-security/) (API Reference)

- [Assign a policy to a computer](create-configure-policy.mdx) (Guide)

- [Configure Computers to Override Policies](override-policies-computer.mdx) (Guide)
::::
