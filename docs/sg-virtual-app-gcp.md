---
id: sg-virtual-app-gcp
title: Deploying a Service Gateway virtual appliance with GCP
sidebar_label: Deploying a Service Gateway virtual appliance with GCP
description: Deploying a Service Gateway virtual appliance with GCP
tags:
  - endpoint-security
  - trend-vision-one
---

/*<![CDATA[*/ $('#title').html($('meta[name=map-description]').attr('content')); /*]]>*/ Deploying a Service Gateway virtual appliance with GCP Launch a Service Gateway virtual appliance from Google Cloud Platform (GCP) using a deployment package. If you do not have VMware, Microsoft Hyper-V, or Nutanix AHV in your environment, you can deploy the Service Gateway virtual appliance from GCP using a deployment package. Before you begin, review the Service Gateway appliance system requirements to ensure your virtual appliance has the settings needed to deploy the services you want to use. Note The steps contained in these instructions are valid as of June 2025. Procedure Obtain the Service Gateway registration token. On the Trend Vision One console, go to Workflow and Automation → Service Gateway Management. Click Download Virtual Appliance. Copy the Registration Token. Note The registration token is used to register the Service Gateway virtual appliance to Service Gateway Inventory after installation and setup are complete. The registration token expires after 24 hours if not used. To initiate the instance launch, sign in to the Google Cloud portal. Create a firewall policy for the Service Gateway virtual appliance you want to deploy. In the Google Cloud portal, open the navigation menu at the upper left of the screen. Go to VPC Network → Firewall. Note If you don't see the service, use the search bar at the top of the screen to search for Firewall. Find Firewall under Search results. Click Create firewall policy. In the 1 Configure policy step, specify a Policy name, select the deployment scope of the firewall policy, and click Continue. In the 2 Add rules step, click Create firewall rule to create a new firewall rule for the Service Gateway virtual appliance. On the Create a firewall rule panel on the right, configure the firewall rule settings. For Priority, specify a positive integer. For more information on priority, refer to the Google Cloud documentation. For Direction of traffic, select Ingress. For Action on match, select Allow. For Target, select the instance where you would like to apply this firewall rule. For Source network type, select the network type that matches the source where the ingress traffic comes. For Source filters, specify the IP type and IP ranges of the source. Note Trend Micro recommends specifying the source IP addresses/CIDR ranges that are within your network. For Protocols and ports, select Specified protocols and ports, select TCP, and add the ports according to the following table. Service Destination port ranges Protocol Action Description SSH 22 TCP Allow For accessing Service Gateway virtual appliance CLISH command HTTP 80 TCP Allow Service enabled queries for on-premises Active Directory servers, connected Trend Micro products (such as endpoint agents), Predictive Machine Learning, File Reputation Services, or Third-Party Integration HTTPS 443 TCP Allow Service enabled queries for on-premises Active Directory servers, connected Trend Micro products (such as endpoint agents), Predictive Machine Learning, File Reputation Services, or Third-Party Integration Custom TCP 5274 TCP Allow Web Reputation Services or Web Inspection Service queries Custom TCP 5275 TCP Allow Web Reputation Services or Web Inspection Service queries Custom TCP 8080 TCP Allow Forward Proxy Service listening port for connection Custom TCP 8088 TCP Allow Zero Trust Secure Access On-Premises Gateway listening port for connection For Enforcement, select Enabled. Review the configuration of this firewall rule, then click Create. Select the firewall just created, and click Continue. In the 3 Associate policy with VPC networks (optional) step, click Associate to associate this firewall policy with existing VPC networks. Note If you do not have any VPC network, refer to Google Cloud documentation to create one. Review the configuration of this firewall policy, then click Create. Create a VM instance. Go to Compute Engine → VM instances. In the Virtual instances screen, click Create instance. In the Create an instance screen, choose Create VM from… → Marketplace. In the Marketplace screen, select Trend Vision One™ Service Gateway to deploy. In the Marketplace screen, search for the product Trend Vision One™ Service Gateway. Select Trend Vision One™ Service Gateway in the results. Click Get Started and agree to the terms and agreements before the deployment. A dialog for successfully agreeing to terms will pop up. Click Deploy to proceed. Click Launch to proceed with the deployment. Choose one of the following ways to deploy Trend Vision One™ Service Gateway. Deployment method Steps Terraform Specify a Deployment name. In the Deployment Service Account section: Select an Existing account which has the roles/config.agent, roles/compute.admin, and roles/iam.serviceAccountUser roles, or create a new account for the deployment. Select a Zone for the location where Trend Vision One™ Service Gateway will be deployed. In the Machine type section, select a machine type that meets the specifications for your deployment. Note The default machine type is e2-highcpu-16 with 16 vCPU and 16 GB memory. For more information, see Service Gateway appliance system requirements. In the Boot Disk section: Select the disk type that meet the specifications for your deployment in Boot disk type. Specify a disk size for Boot disk size in GB. Note The default disk size and disk type is 500 GB and Balanced Persistent Disk respectively. For more information, see Service Gateway appliance system requirements. In the Network interfaces section, edit the following settings of the network interface: Select the VPC where the firewall policy created in previous steps is applied for Network. Select the desired subnetwork for Subnetwork. Note Refer to the Google Cloud documentation on how to set up a VPC network and subnets. Select None for External IP. Review the VM instance settings, and click Deploy to deploy Trend Vision One™ Service Gateway. Command-line deployment Agree to the terms of service and click Next. In the Configure a service account (Optional) section, click Configure to select an existing account which has the roles/compute.admin and roles/iam.serviceAccountUser roles, or create a new account for the deployment. In the Configure gcloud section, run all the mentioned commands to configure the gcloud environment. Note Install gcloud before running these commands. In the Review VM images section, click Download to download the zipped file, which includes the Terraform scripts of deploying Trend Vision One™ Service Gateway, to your local environment. Unzip the downloaded file. Click SHOW COMMAND to display all the required Terraform commands for the deployment. Open a terminal, change the current directory to the unzipped folder, and run all the Terraform commands mentioned in step 6 for deploying a Trend Vision One™ Service Gateway VM instance to the specified Google Cloud project. # Configure the current gcloud environment for Terraform gcloud config set project <project_name> gcloud auth application-default login # Deploy Trend Vision One™ Service Gateway VM instance on Google Cloud Platform cd path/to/unzipped/folder terraform init terraform apply # There are two parameters to be input during the deployment: # var.goog_cm_deployment_name # The name of the deployment and VM instance. # var.project_id # The ID of the project in which to provision resources. # After providing values for these parameters, type `yes` to proceed. Note Install Terraform before running these commands. After the deployment is completed, go to Compute Engine → VM instances screen. Trend Vision One™ Service Gateway is ready to connect and configure when Status shows (green check). Connect to the VM instance. In the Virtual instances screen, click next to SSH of the Service Gateway virtual appliance instance, and select Open in browser window. In the SSH-in-browser that pops up, click Authorize to authorize this SSH connection via your Google account. Now you are connected to the Service Gateway virtual appliance instance. Configure and register the Service Gateway. Type the following command to switch the user to admin: su admin Input the default password: V1SG@2021. Change your password. After the new password is applied, the Command Line Interface (CLI) appears. Type enable and press the ENTER key to enable administrative commands. The command prompt changes from > to #. Use the configure command to configure the required network settings, such as the IP address and DNS settings. Type the following command to register the Service Gateway virtual appliance to Trend Vision One. register <registration_token> Use the registration token you obtained from Service Gateway Inventory. Use the CLI to configure other settings, if required. For more information on available commands, see Service Gateway CLI commands. © 2025 Trend Micro Incorporated. All rights reserved.Search Knowledge Base