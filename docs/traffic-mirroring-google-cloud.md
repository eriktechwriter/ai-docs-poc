---
id: traffic-mirroring-google-cloud
title: Configure traffic mirroring on Google Cloud
sidebar_label: Configure traffic mirroring on Google Cloud
description: Configure traffic mirroring on Google Cloud
tags:
  - endpoint-security
  - trend-vision-one
---

/*<![CDATA[*/ $('#title').html($('meta[name=map-description]').attr('content')); /*]]>*/ Configure traffic mirroring on Google Cloud Set up your VPC networks to enable traffic mirroring to your Virtual Network Sensor data port. Note The steps contained in these instructions are valid as of July 2024. You can use your preferred method to set up traffic mirroring in your Google Cloud environment, or follow the steps outline in the Google Cloud documentation for packet mirroring. If you are unsure about what settings to use, follow the steps in this guide to set up traffic mirroring. This method has been tested by Trend Micro for deploying the Virtual Network Sensor. Before you get started, make sure you have decided which virtual machine (VM) to use as your mirror source. The mirror source VM is the data source for packet mirroring to the Virtual Network Sensor data port. Procedure Set up network peering. Trend Micro recommends locating the Virtual Network Sensor data port to a separate VPC network than the mirror source VM. If you assigned the data port to the same network as the mirror source VM, skip to the next step. Important If you are using multiple VPC networks, you must set up network peering on both VPC networks to enable packet mirroring. In your Google Cloud environment, go to VPC network → VPC networks. Find and click on the VPC network with the mirror source VM. The VPC network details screen appears. Go to VPC Network Peering. Click Add Peering. The Create peering connection screen appears. Specify a unique name for the peering connection. Under Peered VPC netwok, select the VPC network name where the Virtual Network Sensor data port is assigned. Click Create. Go back to the VPC Networks screen. Find and click on the VPC network with the Virtual Network Sensor data port. The VPC network details screen appears. Go to VPC Network Peering. Click Add Peering. The Create peering connection screen appears. Specify a unique name for the peering connection. Under Peered VPC netwok, select the VPC network name where the mirror source VM is located. Click Create. Create an unmanaged instance group. Go to Compute Engine → Instance groups. Click Create Instance Group. The Create Instance Group screen appears. Click New unmanaged instance group. Specify a unique name for the instance group. Select the Location where the Virtual Network Sensor is deployed. Select the Network where the Virtual Network Sensor management port is located. Select the Subnetwork where the Virtual Network Sensor management port is located. For VM instances, select the Virtual Network Sensor instance. Click Create. Create a health check. Go to Compute Engine → Health checks. Click Create Health Check. The Create a health check screen appears. Specify a unique name for the health check. For Protocol, select TCP. For Port, type 14789. Click Create. Create a load balancer. Go to Network services → Load balancing. Click Create Load Balancer. The Create a load balancer screen appears. For Type of load balancer, select Network Load Balancer (TCP/UDP/SSL) and click Next. For Proxy or passthrough, select Passthrough load balancer and click Next.. For Public facing or internal, select Internal and click Next.. Click Configure. The Create internal passthrough Network Load Balancer screen appears. Specify a unique name for the load balancer. Select the same Region where the Virtual Network Sensor is deployed. Select the same Network where the Virtual Network Sensor data port is located. If the Backend configuration does not automatically display, click Backend configuration. For Backend type, select Instance group. For Protocol, select TCP. Under New backend, select IPV4 (single-stack) for the IP stack type. Select the Instance group you created with the Virtual Network Sensor management port. Select the Health check you created. For Session affinity, select None. Click Done. Click Frontend configuration. Select the Subnetwork where the Virtual Network Sensor data port is located. For Ports, select All. Expand Advanced Configurations. Select Enable this load balancer for Packet Mirroring. Click Done. Click Create. Create a packet mirroring policy. Go to VPC network → Packet mirroring. Click Create Policy. The Create policy screen appears. Specify a unique Policy name. Select the same Region where the Virtual Network Sensor is deployed. Click Continue. Select the VPC networks. If you assigned the Virtual Network Sensor data port to the same network as the mirror source VM, select Mirrored source and collector destination are in the same VPC network, then select the VPC network they are located on. If you assigned the Virtual Network Sensor data port to a different network than the mirror source VM, select Mirrored source and collector destination are in separate, peered VPC networks, then select the following:. Mirrored source VPC network: Select the network of the mirror source VM Collector destination VPC network: Select the network of the Virtual Network Sensor data port Click Continue. For Mirrored source, select Select individual instances and click Select. In the screen that appears, select the mirror source VM and click Select. Click Continue. Select the load balancer you created as the Collector destination. The load balancer might appear with the format NAME-forwarding-rule (NAME). Click Continue. Select Mirror all IPv4 traffic (default). Click Submit. Configure firewall rules for the Virtual Network Sensor data port. Trend Micro recommends setting the firewall rules for the Virtual Network Sensor data port to allow all traffic into the port to allow maximum visibility into network traffic. Go to VPC network → VPC networks. Fine the VPC network where the Virtual Network Sensor data port is located and click the name. The VPC network details screen appears. Go to Firewalls. Click Add Firewall Rule. The Create a firewall rule screen appears. Specify a unique name for the firewall rule. For Direction of traffic, select Ingress. For Action on match, select Allow. For Targets, select the Virtual Network Sensor. If you deployed the Virtual Network Sensor data port to a new VPC network by itself, you can select All instances in the network. For Source IPv4 ranges, type 0.0.0.0/0 to allow all sources. For Protocols and ports, select Allow all. Click Create. Mirrored traffic starts flowing to the Virtual Network Sensor once all steps are successfully completed. If traffic is not reaching the Virtual Network Sensor, check your configuration. © 2025 Trend Micro Incorporated. All rights reserved.Search Knowledge Base