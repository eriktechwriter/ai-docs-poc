---
slug: trend-vision-one-cis-gke17-541b
title: 5.4.1 - Ensure the GKE Metadata Server is Enabled (Automated)
last_updated: '2025-09-08'
ai_context:
  source_file: cis-gke17-541b.md
  conversion_date: '2025-09-08T23:42:23.604Z'
conversion_status: converted
translation_ready: true
---

::::: {role="main"}
Profile applicability: Level 2

Running the GKE Metadata Server prevents workloads from accessing sensitive instance metadata and facilitates Workload Identity.

Every node stores its metadata on a metadata server. Some of this metadata, such as kubelet credentials and the VM instance identity token, is sensitive and should not be exposed to a Kubernetes workload. Enabling the GKE Metadata server prevents pods (that are not running on the host network) from accessing this metadata and facilitates Workload Identity.

When unspecified, the default setting allows running pods to have full access to the node's underlying metadata server.

:::note

By default, running pods to have full access to the node's underlying metadata server.
:::

### Impact {#impact}

The GKE Metadata Server must be run when using Workload Identity. Because Workload Identity replaces the need to use Metadata Concealment, the two approaches are incompatible.

When the GKE Metadata Server and Workload Identity are enabled, unless the Pod is running on the host network, Pods cannot use the the Compute Engine default service account.

Workloads may need modification in order for them to use Workload Identity. See the [GKE documentation](https://cloud.google.com/kubernetes-engine/docs/how-to/workload-identity) for more information.

### Audit {#audit}

Using Google Cloud Console:

1.  Go to [Kubernetes Engine website](https://console.cloud.google.com/kubernetes/list).
2.  From the list of clusters, click on the name of the cluster of interest.
3.  For each Node pool within the cluster, open the **Details** pane, and ensure that the GKE Metadata Server is set to `Enabled`.

Using Command Line:

To check whether the GKE Metadata Server is enabled for each Node pool within a cluster, run the following command:

``` codeblock
gcloud container clusters describe <cluster_name> --zone <cluster_zone> --
format json | jq .nodePools[].config.workloadMetadataConfig
```

This should return the following for each Node pool:

``` codeblock
{ 
    "mode": "GKE_METADATA" 
}
```

Null (`{ }`) is returned if the GKE Metadata Server is not enabled.

### Remediation {#remediation}

The GKE Metadata Server requires Workload Identity to be enabled on a cluster. Modify the cluster to enable Workload Identity and enable the GKE Metadata Server.

Using Google Cloud Console:

1.  Go to [Kubernetes Engine website](https://console.cloud.google.com/kubernetes/list).
2.  From the list of clusters, select the cluster for which Workload Identity is disabled.
3.  Under the **DETAILS** pane, navigate down to the Security subsection.
4.  Click on the pencil icon named **Edit Workload Identity**, click on **Enable Workload Identity** in the pop-up window, and select a workload pool from the drop-down box. By default, it will be the namespace of the Cloud project containing the cluster, for example: `<project_id>.svc.id.goog.`
5.  Click **SAVE CHANGES** and wait for the cluster to update.
6.  Once the cluster has updated, select each Node pool within the cluster Details page.
7.  For each Node pool, select **EDIT** within the Node pool details page.
8.  Within the **Edit node pool** pane, check the **Enable GKE Metadata Server** checkbox.
9.  Click **SAVE**.

Using Command Line:

``` codeblock
gcloud container clusters update <cluster_name> --identity-
namespace=<project_id>.svc.id.goog
```

:::note

Existing Node pools are unaffected. New Node pools default to `--workload-metadata-from-node=GKE_METADATA_SERVER`.
:::

To modify an existing Node pool to enable GKE Metadata Server:

``` codeblock
gcloud container node-pools update <node_pool_name> --cluster=<cluster_name> 
--workload-metadata-from-node=GKE_METADATA_SERVER
```

Workloads may need modification in order for them to use Workload Identity. See the [GKE documentation](https://cloud.google.com/kubernetes-engine/docs/how-to/workload-identity) for more information.
:::::
